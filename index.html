<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPEED DELIVRO</title>

    <!-- Smart App Banner iOS - Affiche automatiquement une bannière native pour télécharger l'app -->
    <meta name="apple-itunes-app" content="app-id=6747889248, app-argument=speeddelivro://">

    <!-- Open Graph pour partage réseaux sociaux -->
    <meta property="og:title" content="Speed Delivro - Livraison rapide">
    <meta property="og:description" content="Téléchargez l'application Speed Delivro pour commander facilement">
    <meta property="og:image" content="https://levirusdzrzs.github.io/speedapp/appicon.png">
    <meta property="og:url" content="https://app.speeddelivro.com">
    <meta property="og:type" content="website">

    <!-- Redirection intelligente avec support paramètres et détection in-app browser -->
    <script>
        (function() {
            const userAgent = navigator.userAgent || navigator.vendor || window.opera;
            const urlParams = new URLSearchParams(window.location.search);

            // Récupérer les paramètres dynamiques de l'URL
            const orderId = urlParams.get('order') || urlParams.get('o');
            const productId = urlParams.get('product') || urlParams.get('p');
            const screen = urlParams.get('screen') || urlParams.get('s');
            const forceStore = urlParams.get('store') === 'true';

            // Construire le deeplink avec paramètres
            function buildDeeplink() {
                let path = '';
                if (orderId) path = 'order/' + orderId;
                else if (productId) path = 'product/' + productId;
                else if (screen) path = screen;
                return 'speeddelivro://' + path;
            }

            // Détecter les in-app browsers (Facebook, Instagram, Messenger, etc.)
            function isInAppBrowser() {
                const inAppPatterns = [
                    'FBAN', 'FBAV',           // Facebook
                    'Instagram',               // Instagram
                    'Messenger',               // Messenger
                    'Twitter',                 // Twitter
                    'Line',                    // Line
                    'KAKAOTALK',              // KakaoTalk
                    'Snapchat',               // Snapchat
                    'WhatsApp',               // WhatsApp (rare mais possible)
                    'LinkedIn',               // LinkedIn
                    'Pinterest'               // Pinterest
                ];
                return inAppPatterns.some(pattern => userAgent.includes(pattern));
            }

            // Afficher la page au lieu de rediriger automatiquement
            function showPage() {
                document.body.style.visibility = 'visible';
            }

            // URLs des stores
            const appStoreUrl = 'https://apps.apple.com/tn/app/speeddelivro/id6747889248';
            const playStoreUrl = 'https://play.google.com/store/apps/details?id=com.speed.delivro.buyer';

            // Si in-app browser détecté, afficher la page avec message
            if (isInAppBrowser()) {
                window.addEventListener('DOMContentLoaded', function() {
                    showPage();
                    // Ajouter un message pour ouvrir dans le navigateur
                    const container = document.querySelector('.container');
                    if (container) {
                        const notice = document.createElement('p');
                        notice.className = 'inapp-notice';
                        notice.innerHTML = '⚠️ Pour une meilleure expérience, ouvrez ce lien dans Safari ou Chrome';
                        notice.style.cssText = 'color:#e74c3c;font-size:13px;margin-bottom:15px;padding:10px;background:#fff5f5;border-radius:8px;';
                        container.insertBefore(notice, container.firstChild.nextSibling);
                    }
                });
                return; // Ne pas rediriger automatiquement
            }

            // Si force store demandé
            if (forceStore) {
                if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
                    window.location.replace(appStoreUrl);
                } else if (/android/i.test(userAgent)) {
                    window.location.replace(playStoreUrl);
                } else {
                    window.location.replace('https://www.speeddelivro.com');
                }
                return;
            }

            // Détection iOS (iPhone, iPad, iPod)
            if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
                const deeplink = buildDeeplink();

                // Essayer d'ouvrir l'app
                window.location.href = deeplink;

                // Si l'app n'est pas installée, afficher la page après un délai
                setTimeout(function() {
                    // Vérifier si on est toujours sur la page (app non ouverte)
                    if (!document.hidden) {
                        showPage();
                        // Optionnel: rediriger vers store après encore 3s
                        // setTimeout(() => window.location.replace(appStoreUrl), 3000);
                    }
                }, 1200);
            }
            // Détection Android
            else if (/android/i.test(userAgent)) {
                // Construire l'intent URL avec le deeplink dynamique
                const deeplink = buildDeeplink();
                const encodedDeeplink = encodeURIComponent(deeplink);

                // Intent URL pour Android avec fallback
                const intentUrl = 'intent://launch#Intent;' +
                    'scheme=speeddelivro;' +
                    'package=com.speed.delivro.buyer;' +
                    'S.browser_fallback_url=' + encodeURIComponent(playStoreUrl) + ';' +
                    (orderId ? 'S.order_id=' + orderId + ';' : '') +
                    (productId ? 'S.product_id=' + productId + ';' : '') +
                    (screen ? 'S.screen=' + screen + ';' : '') +
                    'end';

                window.location.replace(intentUrl);

                // Fallback: afficher la page si l'intent échoue
                setTimeout(showPage, 1500);
            }
            // Desktop - afficher la page
            else {
                window.addEventListener('DOMContentLoaded', showPage);
            }
        })();
    </script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #0019FF 0%, #FFA100 100%);
            padding: 20px;
            position: relative;
            overflow: hidden;
            visibility: hidden; /* Masquer pendant la redirection - sera affiché par JS si nécessaire */
        }

        /* Animation de chargement pendant la tentative de deeplink */
        .loading-spinner {
            display: none;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0019FF;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Style pour le bouton d'ouverture directe de l'app */
        .open-app-btn {
            display: inline-block;
            background: linear-gradient(135deg, #0019FF 0%, #4a5aff 100%);
            color: white;
            padding: 16px 40px;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 600;
            text-decoration: none;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 25, 255, 0.3);
        }

        .open-app-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 25, 255, 0.4);
        }

        .open-app-btn:active {
            transform: translateY(0);
        }

        .separator {
            color: #999;
            font-size: 14px;
            margin: 15px 0;
        }
        
        /* Images décoratives sur les côtés */
        .side-image {
            position: fixed;
            width: 250px;
            height: auto;
            opacity: 0.15;
            z-index: 0;
        }
        
        .side-image.left {
            left: 180px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .side-image.right {
            right: 180px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .container {
            background: white;
            border-radius: 24px;
            padding: 50px 30px 40px;
            box-shadow: 0 20px 60px rgba(0, 25, 255, 0.3);
            max-width: 420px;
            width: 100%;
            text-align: center;
            position: relative;
            z-index: 1;
        }
        
        .app-icon {
            width: 120px;
            height: 120px;
            margin: 0 auto 25px;
            background: white;
            border-radius: 26px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 40px rgba(0, 25, 255, 0.2);
            overflow: hidden;
            border: 0px solid #f0f0f0;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .app-icon:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 50px rgba(0, 25, 255, 0.35);
        }

        .app-icon:active {
            transform: scale(0.98);
        }

        .app-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            padding: 0px;
            pointer-events: none;
        }
        
        h1 {
            font-size: 32px;
            color: #0019FF;
            margin-bottom: 12px;
            font-weight: 800;
            letter-spacing: -0.5px;
        }
        
        .subtitle {
            color: #666;
            font-size: 17px;
            margin-bottom: 35px;
            font-weight: 400;
        }
        
        .buttons {
            display: flex;
            flex-direction: column;
            gap: 16px;
            align-items: center;
        }
        
        .store-button {
            display: inline-block;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 12px;
            overflow: hidden;
        }
        
        .store-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }
        
        .store-button:active {
            transform: translateY(-1px);
        }
        
        .store-button img {
            display: block;
            width: 200px;
            height: auto;
        }
        
        /* Responsive pour mobile */
        @media (max-width: 768px) {
            .side-image {
                width: 180px;
                opacity: 0.1;
            }
            
            .side-image.left {
                left: -50px;
            }
            
            .side-image.right {
                right: -50px;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 15px;
            }
            
            .side-image {
                width: 140px;
                opacity: 0.08;
            }
            
            .side-image.left {
                left: -60px;
            }
            
            .side-image.right {
                right: -60px;
            }
            
            .container {
                padding: 40px 25px 35px;
                border-radius: 20px;
            }
            
            .app-icon {
                width: 100px;
                height: 100px;
                margin-bottom: 20px;
            }
            
            h1 {
                font-size: 26px;
                margin-bottom: 10px;
            }
            
            .subtitle {
                font-size: 15px;
                margin-bottom: 30px;
            }
            
            .store-button img {
                width: 170px;
            }
        }
        
        /* Très petits écrans */
        @media (max-width: 360px) {
            .container {
                padding: 35px 20px 30px;
            }
            
            .app-icon {
                width: 90px;
                height: 90px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .store-button img {
                width: 150px;
            }
        }
    </style>
</head>
<body>
    <!-- Images décoratives sur les côtés -->
    <img src="https://levirusdzrzs.github.io/speedapp/CLIENT.png" alt="" class="side-image left">
    <img src="https://levirusdzrzs.github.io/speedapp/CLIENT1.png" alt="" class="side-image right">
    
    <div class="container">
        <div class="app-icon" id="appIcon">
            <img src="https://levirusdzrzs.github.io/speedapp/appicon.png" alt="Logo SPEED DELIVRO">
        </div>
        <h1>SPEED DELIVRO</h1>
        <p class="subtitle" id="subtitle">Redirection en cours...</p>

        <div class="buttons">
            <!-- Bouton pour ouvrir directement l'app si installée -->
            <a href="speeddelivro://" id="openAppBtn" class="open-app-btn">
                Ouvrir l'application
            </a>

            <p class="separator">ou téléchargez l'application</p>

            <a href="https://play.google.com/store/apps/details?id=com.speed.delivro.buyer" target="_blank" class="store-button" id="playStoreBtn">
                <img src="https://upload.wikimedia.org/wikipedia/commons/8/8e/Google_Play_Store_badge_FR.svg" alt="Télécharger sur Google Play">
            </a>

            <a href="https://apps.apple.com/tn/app/speeddelivro/id6747889248" target="_blank" class="store-button" id="appStoreBtn">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/40/Download_on_the_App_Store_Badge_FRCA_RGB_blk.svg/1280px-Download_on_the_App_Store_Badge_FRCA_RGB_blk.svg.png" alt="Télécharger sur App Store">
            </a>
        </div>

        <!-- Script pour mettre à jour le deeplink du bouton avec les paramètres URL -->
        <script>
            (function() {
                const urlParams = new URLSearchParams(window.location.search);
                const orderId = urlParams.get('order') || urlParams.get('o');
                const productId = urlParams.get('product') || urlParams.get('p');
                const screen = urlParams.get('screen') || urlParams.get('s');

                let path = '';
                if (orderId) path = 'order/' + orderId;
                else if (productId) path = 'product/' + productId;
                else if (screen) path = screen;

                const deeplink = 'speeddelivro://' + path;
                const btn = document.getElementById('openAppBtn');
                if (btn) btn.href = deeplink;

                // Mettre à jour le subtitle quand la page est visible
                const subtitle = document.getElementById('subtitle');
                if (document.body.style.visibility === 'visible' && subtitle) {
                    subtitle.textContent = 'Livraison rapide et fiable';
                }

                // Masquer le bouton store non pertinent selon la plateforme
                const ua = navigator.userAgent;
                if (/iPad|iPhone|iPod/.test(ua)) {
                    const playBtn = document.getElementById('playStoreBtn');
                    if (playBtn) playBtn.style.display = 'none';
                } else if (/android/i.test(ua)) {
                    const appBtn = document.getElementById('appStoreBtn');
                    if (appBtn) appBtn.style.display = 'none';
                }
            })();
        </script>
    </div>
</body>
<style>
    .whatsapp-button {
        position: fixed;
        bottom: 100px;
        right: 20px;
        width: 60px;
        height: 60px;
        background-color: #25D366;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        cursor: pointer;
        z-index: 9999;
        transition: transform 0.3s;
    }
    
    .whatsapp-button:hover {
        transform: scale(1.1);
    }
    
    .whatsapp-button svg {
        width: 35px;
        height: 35px;
        fill: white;
    }
</style>

<a href="https://wa.me/21623800073?text=Bonjour" target="_blank" class="whatsapp-button">
    <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
        <path d="M16 0c-8.837 0-16 7.163-16 16 0 2.825 0.737 5.607 2.137 8.048l-2.137 7.952 7.933-2.127c2.42 1.37 5.173 2.127 8.067 2.127 8.837 0 16-7.163 16-16s-7.163-16-16-16zM16 29.467c-2.482 0-4.908-0.646-7.07-1.87l-0.507-0.292-5.247 1.403 1.417-5.267-0.321-0.525c-1.331-2.183-2.039-4.706-2.039-7.313 0-7.72 6.28-14 14-14s14 6.28 14 14-6.28 14-14 14zM23.463 19.537c-0.397-0.199-2.354-1.161-2.719-1.294-0.365-0.133-0.631-0.199-0.896 0.199s-1.030 1.294-1.262 1.56c-0.232 0.266-0.464 0.298-0.861 0.099-2.215-1.105-3.665-1.974-5.126-4.476-0.386-0.661 0.386-0.614 1.104-2.045 0.12-0.266 0.060-0.497-0.033-0.696-0.093-0.199-0.896-2.157-1.228-2.954-0.323-0.776-0.651-0.671-0.896-0.684-0.232-0.012-0.497-0.015-0.762-0.015s-0.696 0.099-1.061 0.497c-0.365 0.398-1.394 1.361-1.394 3.319s1.427 3.852 1.627 4.118c0.199 0.266 2.807 4.283 6.802 6.005 2.563 1.104 3.567 1.192 4.848 1.005 0.777-0.115 2.354-0.962 2.686-1.891s0.332-1.726 0.232-1.891c-0.099-0.165-0.365-0.265-0.762-0.464z"/>
    </svg>
</a>
</html>
